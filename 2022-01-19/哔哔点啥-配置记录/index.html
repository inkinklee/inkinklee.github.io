<!DOCTYPE html>
<html lang='zh-CN'>

<head>
  <meta name="generator" content="Hexo 5.4.2">
  <meta name="hexo-theme" content="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.18.5">
  <meta charset="utf-8">
  

  <meta http-equiv='x-dns-prefetch-control' content='on' />
  <link rel='dns-prefetch' href='https://gcore.jsdelivr.net'>
  <link rel="preconnect" href="https://gcore.jsdelivr.net" crossorigin>
  <link rel='dns-prefetch' href='//unpkg.com'>

  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" content="#f8f8f8">
  
  <title>BBer：哔哔点啥-配置记录 - INKLEE</title>

  
    <meta name="description" content="配置 哔哔点啥 的记录和踩坑，前部分是哔哔发展历程，后部分是 哔哔点啥2.0 配置">
<meta property="og:type" content="article">
<meta property="og:title" content="BBer：哔哔点啥-配置记录">
<meta property="og:url" content="https://blog.inklee.top/2022-01-19/%E5%93%94%E5%93%94%E7%82%B9%E5%95%A5-%E9%85%8D%E7%BD%AE%E8%AE%B0%E5%BD%95/">
<meta property="og:site_name" content="INKLEE">
<meta property="og:description" content="配置 哔哔点啥 的记录和踩坑，前部分是哔哔发展历程，后部分是 哔哔点啥2.0 配置">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.hermitlsr.top/images/post/bber/20220119184545.png!watermark">
<meta property="og:image" content="https://cdn.hermitlsr.top/images/post/bber/20220119184650.png!watermark">
<meta property="og:image" content="https://cdn.hermitlsr.top/images/post/bber/20220119184714.png!watermark">
<meta property="og:image" content="https://cdn.hermitlsr.top/images/post/bber/20220119190000.png!watermark">
<meta property="og:image" content="https://cdn.hermitlsr.top/images/post/bber/20220119190450.png!watermark">
<meta property="og:image" content="https://cdn.hermitlsr.top/images/post/bber/20220119190540.png!watermark">
<meta property="og:image" content="https://cdn.hermitlsr.top/images/post/bber/20220119190930.png!watermark">
<meta property="og:image" content="https://cdn.hermitlsr.top/images/post/bber/20220119191027.png!watermark">
<meta property="og:image" content="https://cdn.hermitlsr.top/images/post/bber/20220119200323.png!watermark">
<meta property="og:image" content="https://cdn.hermitlsr.top/images/post/bber/20220119192915.png!watermark">
<meta property="og:image" content="https://cdn.hermitlsr.top/images/post/bber/20220119192854.png!watermark">
<meta property="og:image" content="https://cdn.hermitlsr.top/images/post/bber/20220119193201.png!watermark">
<meta property="og:image" content="https://cdn.hermitlsr.top/images/post/bber/20220119193340.png!watermark">
<meta property="og:image" content="https://cdn.hermitlsr.top/images/post/bber/20220119195114.png!watermark">
<meta property="og:image" content="https://cdn.hermitlsr.top/images/post/bber/20220119205230.png!watermark">
<meta property="og:image" content="https://cdn.hermitlsr.top/images/post/bber/20220119205354.png!watermark">
<meta property="og:image" content="https://cdn.hermitlsr.top/images/post/bber/20220119210322.png!watermark">
<meta property="og:image" content="https://cdn.hermitlsr.top/images/post/bber/20220119202332.png!watermark">
<meta property="article:published_time" content="2022-01-19T08:54:32.000Z">
<meta property="article:modified_time" content="2023-02-27T13:37:10.702Z">
<meta property="article:author" content="inklee">
<meta property="article:tag" content="Hexo">
<meta property="article:tag" content="tencent cloud，bber">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://cdn.hermitlsr.top/images/post/bber/20220119184545.png!watermark">
  
  

  <!-- feed -->
  

  
    
<link rel="stylesheet" href="/css/main.css">

  

  
    <link rel="shortcut icon" href="https://cdn.hermitlsr.top/images/web/rick32.png">
  

  

  
    <link rel="stylesheet" href="https://gcore.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css" integrity="sha384-vKruj+a13U8yHIkAyGgK1J3ArTLzrFGBbBc0tDp4ad/EyewESeXE/Iv67Aj8gKZ0" crossorigin="anonymous">
    <script defer src="https://gcore.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js" integrity="sha384-PwRUT/YqbnEjkZO0zZxNqcxACrXe+j766U2amXcgMg5457rve2Y7I6ZJSm2A0mS4" crossorigin="anonymous"></script>
    <script defer src="https://gcore.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"onload="renderMathInElement(document.body);"></script>
  


  
    
      <link rel="preconnect" href="https://s1.hdslb.com/" />
    
      <link rel="stylesheet" href="//s1.hdslb.com/bfs/static/jinkela/long/font/regular.css" media="all" onload="this.media='all'" />
    
      <link rel="stylesheet" href="//s1.hdslb.com/bfs/static/jinkela/long/font/medium.css" media="all" onload="this.media='all'" />
    
  
</head>

<body>
  




  <div class='l_body' id='start'>
    <aside class='l_left' layout='post'>
    

  

<header class="header"><div class="logo-wrap"><a class="avatar" href="/about/"><div class="bg" style="opacity:0;background-image:url(https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.4/avatar/round/rainbow64@3x.webp);"></div><img no-lazy class="avatar" src="https://cdn.hermitlsr.top/images/web/rickavatar.png" onerror="javascript:this.classList.add('error');this.src='https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.4/image/2659360.svg';"></a><a class="title" href="/"><div class="main" ff="title">INKLEE</div><div class="sub normal cap">道阻且长，行则将至</div><div class="sub hover cap" style="opacity:0"> blog.inklee.top</div></a></div>

<nav class="menu dis-select"><a class="nav-item active" href="/">文章</a><a class="nav-item" href="/wiki/">项目</a><a class="nav-item" href="/notes/">便笺</a><a class="nav-item" href="/about/">更多</a></nav>
</header>


<div class="widgets">
<widget class="widget-wrapper search"><div class="widget-body"><div class="search-wrapper" id="search"><form class="search-form"><input type="text" class="search-input" id="search-input" data-filter="/blog/" placeholder="文章搜索"><svg t="1670596976048" class="icon search-icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2676" width="200" height="200"><path d="M938.2 832.6L723.8 618.1c-2.5-2.5-5.3-4.4-7.9-6.4 36.2-55.6 57.3-121.8 57.3-193.1C773.3 222.8 614.6 64 418.7 64S64 222.8 64 418.6c0 195.9 158.8 354.6 354.6 354.6 71.3 0 137.5-21.2 193.2-57.4 2 2.7 3.9 5.4 6.3 7.8L832.5 938c14.6 14.6 33.7 21.9 52.8 21.9 19.1 0 38.2-7.3 52.8-21.8 29.2-29.1 29.2-76.4 0.1-105.5M418.7 661.3C284.9 661.3 176 552.4 176 418.6 176 284.9 284.9 176 418.7 176c133.8 0 242.6 108.9 242.6 242.7 0 133.7-108.9 242.6-242.6 242.6" p-id="2677"></path></svg></form><div id="search-result"></div><div class="search-no-result">没有找到内容！</div></div></div></widget>


<widget class="widget-wrapper toc single" id="data-toc"><div class="widget-header cap dis-select"><span class="name">BBer：哔哔点啥-配置记录</span></div><div class="widget-body fs14"><div class="doc-tree active"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%93%94%E5%93%94%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B"><span class="toc-text"> 1 哔哔发展历程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#artitalkjs"><span class="toc-text"> Artitalk.js</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bbtalk"><span class="toc-text"> BBtalk</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bber%E5%93%94%E5%93%94%E7%82%B9%E5%95%A5-%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7-20"><span class="toc-text"> BBer：哔哔点啥 微信公众号 2.0</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%93%94%E5%93%94%E7%82%B9%E5%95%A5-%E5%90%8E%E7%AB%AF%E9%85%8D%E7%BD%AE"><span class="toc-text"> 2 哔哔点啥-后端配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#21-%E5%88%9B%E5%BB%BA%E5%BA%94%E7%94%A8"><span class="toc-text"> 2.1 创建应用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#211-%E6%96%B0%E5%BB%BA%E7%8E%AF%E5%A2%83"><span class="toc-text"> 2.1.1 新建环境</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#212-%E7%8E%AF%E5%A2%83-%E7%99%BB%E5%BD%95%E6%8E%88%E6%9D%83"><span class="toc-text"> 2.1.2 环境-登录授权</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#213-%E7%8E%AF%E5%A2%83-%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE"><span class="toc-text"> 2.1.3 环境-安全配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#214-%E6%96%B0%E5%BB%BA%E6%95%B0%E6%8D%AE%E9%9B%86%E5%90%88"><span class="toc-text"> 2.1.4 新建数据集合</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-%E4%BA%91%E5%87%BD%E6%95%B0%E9%83%A8%E7%BD%B2"><span class="toc-text"> 2.2 云函数部署</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#221-%E6%96%B0%E5%BB%BA%E4%BA%91%E5%87%BD%E6%95%B0"><span class="toc-text"> 2.2.1 新建云函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#222-%E7%8E%AF%E5%A2%83-%E8%AE%BF%E9%97%AE%E6%9C%8D%E5%8A%A1"><span class="toc-text"> 2.2.2 环境-访问服务</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%93%94%E5%93%94%E7%82%B9%E5%95%A5-%E5%89%8D%E7%AB%AF%E9%85%8D%E7%BD%AE"><span class="toc-text"> 3 哔哔点啥-前端配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%93%94%E5%93%94%E7%82%B9%E5%95%A5-%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7%E9%85%8D%E7%BD%AE"><span class="toc-text"> 4 哔哔点啥-微信公众号配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#41-%E6%96%B0%E5%BB%BA%E4%BA%91%E5%87%BD%E6%95%B0"><span class="toc-text"> 4.1 新建云函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#42-%E8%8E%B7%E5%8F%96%E5%85%AC%E7%BD%91-ip"><span class="toc-text"> 4.2 获取公网 Ip</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#43-%E6%96%B0%E5%BB%BA%E6%95%B0%E6%8D%AE%E9%9B%86%E5%90%88"><span class="toc-text"> 4.3 新建数据集合</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#44-%E8%8E%B7%E5%8F%96%E8%A7%A6%E5%8F%91%E8%B7%AF%E5%BE%84%E9%93%BE%E6%8E%A5"><span class="toc-text"> 4.4 获取触发路径链接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#45-%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%B9%B3%E5%8F%B0%E9%85%8D%E7%BD%AE"><span class="toc-text"> 4.5 微信公众平台配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#46-%E5%9B%9E-bber-weixin-%E4%BA%91%E5%87%BD%E6%95%B0"><span class="toc-text"> 4.6 回 bber-weixin 云函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#46-%E5%9B%9E-%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%B9%B3%E5%8F%B0"><span class="toc-text"> 4.6 回 微信公众平台</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#47-%E5%9B%9E-bber-weixin-%E4%BA%91%E5%87%BD%E6%95%B0"><span class="toc-text"> 4.7 回 bber-weixin 云函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2%E7%9A%84-stellar-%E4%B8%BB%E9%A2%98%E9%80%82%E9%85%8D"><span class="toc-text"> 5 前端页面的 stellar 主题适配</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#51-%E5%9C%A8%E6%A0%B9%E7%9B%AE%E5%BD%95-source-%E6%96%B0%E5%BB%BA-bbtalk-%E6%96%87%E4%BB%B6%E5%A4%B9"><span class="toc-text"> 5.1 在根目录 source 新建 bbtalk 文件夹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#52-%E9%85%8D%E7%BD%AE%E5%88%B0%E9%A6%96%E9%A1%B5"><span class="toc-text"> 5.2 配置到首页</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#521-%E4%BF%AE%E6%94%B9%E4%B8%BB%E9%A2%98%E6%96%87%E4%BB%B6-languages"><span class="toc-text"> 5.2.1 修改主题文件 languages</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#522-%E4%BF%AE%E6%94%B9%E4%B8%BB%E9%A2%98%E6%96%87%E4%BB%B6-themesstellarlayout_partialmainnavbarlist_postejs"><span class="toc-text"> 5.2.2 修改主题文件 \themes\stellar\layout\_partial\main\navbar\list_post.ejs</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#523-%E4%BF%AE%E6%94%B9%E7%BD%91%E7%AB%99%E8%AE%BE%E7%BD%AE-_configyml"><span class="toc-text"> 5.2.3 修改网站设置 _config.yml</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E8%B8%A9%E5%9D%91%E7%82%B9%E6%B1%87%E6%80%BB"><span class="toc-text"> 6 踩坑点汇总</span></a></li></ol></div></div></widget>
</div>


    </aside>
    <div class='l_main'>
      

      

    




<div class="bread-nav fs12"><div id="breadcrumb"><a class="cap breadcrumb" href="/">INKLEE</a><span class="sep"></span><a class="cap breadcrumb" href="/">文章</a><span class="sep"></span><a class="cap breadcrumb-link" href="/categories/%E5%8D%9A%E5%AE%A2%E6%8A%98%E8%85%BE/">博客折腾</a></div><div id="post-meta">发布于&nbsp;<time datetime="2022-01-19T08:54:32.000Z">2022-01-19</time></div></div>

<article class='md-text content post'>
<h1 class="article-title"><span>BBer：哔哔点啥-配置记录</span></h1>
<p>   配置 <code>哔哔点啥</code> 的记录和踩坑，前部分是哔哔发展历程，后部分是 哔哔点啥2.0 配置</p>
<span id="more"></span>
<div class="tag-plugin grid" ><div class="cell" index="0"></div></div>
<h2 id="1-哔哔发展历程"><a class="markdownIt-Anchor" href="#1-哔哔发展历程"></a> 1 哔哔发展历程</h2>
<h3 id="artitalkjs"><a class="markdownIt-Anchor" href="#artitalkjs"></a> <a target="_blank" rel="noopener" href="https://artitalk.js.org/">Artitalk.js</a></h3>
<p>这个应该是比较早的 <code>说说</code> 了，基于 <code>LeanCloud</code>，很多博客都集成了这个说说功能，可以说是现在说说的开山？</p>
<p>a. 基本功能具备：<br />
支持增删查改，支持对每条说说的评论，支持 Markdown、html语法，支持图片上传。</p>
<p>b. 配置方便灵活：<br />
后端 leancloud 配置过程简单，前端就是一般的 <code>html</code> 几乎可用于任何框架。</p>
<p>c. 安全性一般：</p>
<blockquote>
<p>由于 leancloud 的机制，应用的 Appid 以及 Appkey 均会暴漏在前端，可能会遭受到其他人的恶意攻击。 如果你在担心这个问题，你可以使用 Artitalk_SafeMode。</p>
</blockquote>
<p>问题是，每次发布说说需要打开博客说说页面登录，发布一条说说和发布一个评论差不多，比较麻烦。</p>
<h3 id="bbtalk"><a class="markdownIt-Anchor" href="#bbtalk"></a> <a target="_blank" rel="noopener" href="https://bb.js.org/">BBtalk</a></h3>
<p>该说说，由 <code>heson</code> 大佬开发，最开始在其博客连载开发过程。</p>
<p>开发历程可见大佬博客 ：<a target="_blank" rel="noopener" href="https://www.heson10.com/categories/hexo/%E5%93%94%E5%93%94/">黑石博客分类“哔哔”下的文章</a></p>
<p>其起源于 熊野大佬 的 <a target="_blank" rel="noopener" href="https://bearye.cn/archives/488">哔哔点啥，换个舒服的姿势</a> ，基于静态存储+云函数+微信公众号开发</p>
<p>黑石大佬将其适配了多个主题，并开发了 <code>Hexo-bb</code> 插件，可以方便的在任何一个主题使用，后端依然使用 <code>leancloud</code> ，支持微信公众号发文。</p>
<h3 id="bber哔哔点啥-微信公众号-20"><a class="markdownIt-Anchor" href="#bber哔哔点啥-微信公众号-20"></a> <a target="_blank" rel="noopener" href="https://immmmm.com/bb-by-wechat-pro/#%e9%99%84%e8%b5%a01-alfred-workflow">BBer：哔哔点啥 微信公众号 2.0</a></h3>
<p>这是 熊野大佬 哔哔点啥的升级版，由 林帅 开发，看博客评论都叫他木老师，事实上第一版的公众号发文也是放到了木老师的公众号上。</p>
<p>所以，实际上，<code>BBtalk</code> 和 <code>BBer</code> 是同源的，都是来自 <code>熊野大佬</code> 的版本。</p>
<p>2.0 和 1.0 的主要区别在于，使用的后端平台由 <code>LeandCLoud</code> 变化为 <code>腾讯 CLoudBase</code>，公众号支持由单用户扩展为多用户。</p>
<p>说说可以通过微信公众号发布（看文章封面图，就是那个公众号），目前已支持用户名绑定、解绑、发文字、发图片、追加、合并、删除、替换文字，还有显示哔哔列表、哔哔搜索！<br />
目前支持的命令如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">「哔哔秘笈」</span><br><span class="line">==================</span><br><span class="line">/l - 显示最近哔哔</span><br><span class="line">/s 关键词 - 搜索内容</span><br><span class="line">---------------</span><br><span class="line">/a 文字 - 追加文字到第1条</span><br><span class="line">/a数字 文字 - 追加文字到第几条，如 /a2 文字</span><br><span class="line">---------------</span><br><span class="line">/c - 合并前2条</span><br><span class="line">/c数字 - 合并前几条，如 /c3</span><br><span class="line">---------------</span><br><span class="line">/d - 删除第1条</span><br><span class="line">/d数字 - 删除第几条，如 /d2</span><br><span class="line">---------------</span><br><span class="line">/e 文字- 编辑替换第1条</span><br><span class="line">/e数字 文字 - 编辑替换第几条，如 /e2 文字</span><br><span class="line">---------------</span><br><span class="line">/f数字 - 批量删除前几条，如 /f2</span><br><span class="line">---------------</span><br><span class="line">/nobber - 解除绑定</span><br></pre></td></tr></table></figure>
<p>同时 2.0 提供了 <code>BBer-weixin</code> 微信公众号的后端配置，可以完全把所有数据掌握在自己手里【用自己的公众号】</p>
<p>另外，有不少大佬给 <code>BBer</code> 扩展了功能，主要是前端部分以及发布方式<br />
小康大佬 提供了美化的前端页面 和 浏览器扩展插件发布说说<br />
Guo Le 在此基础上，加入了歌曲分享支持，对浏览器插件，不同浏览器设置不同的 <code>from</code> 源<br />
同时由于 BBer 的发布接口简洁，可以通过 <code>ios</code> 快捷指令发布，android 也有 apk 支持。</p>
<p>所以本站选择了功能丰富的 <code>哔哔点啥 2.0</code>。</p>
<h2 id="2-哔哔点啥-后端配置"><a class="markdownIt-Anchor" href="#2-哔哔点啥-后端配置"></a> 2 哔哔点啥-后端配置</h2>
<p>这部分主要是原作者教程的搬运：<a target="_blank" rel="noopener" href="https://immmmm.com/bb-by-wechat-pro/#%e9%99%84%e8%b5%a01-alfred-workflow">BBer：哔哔点啥 微信公众号 2.0</a> ，但更详细了些。<br />
原作者提供了腾讯云开发一键部署，但是其支持按量计费，不太经济。个人建议，手动部署就好了，麻烦是麻烦了点，但是有本文的帮助，相信一定不会有问题。<br />
配置的时候最好手机在身边，需要多次扫码验证身份。</p>
<p>默认大家都有腾讯云的账号，我是在一开始建站的时候就用的腾讯云，没有的话先注册一个。</p>
<h3 id="21-创建应用"><a class="markdownIt-Anchor" href="#21-创建应用"></a> 2.1 创建应用</h3>
<h4 id="211-新建环境"><a class="markdownIt-Anchor" href="#211-新建环境"></a> 2.1.1 <a target="_blank" rel="noopener" href="https://console.cloud.tencent.com/tcb/">新建环境</a></h4>
<p>这里，选择空模板进入下一步，环境名称自由填写，推荐选择计费方式包年包月，实际上按小站的访问量和发说说的次数， <mark class="tag-plugin mark" color="blue">免费版</mark> 就够用了，不放心的话就采用基础版套餐1，先买个一个月，选择环境到期后自动降为免费版，到时候根据实际使用情况进行续费或者继续使用免费版。<br />
唯一值得注意的是，建议创建上海环境，否则在前端页面配置时要指定 <code>region: “ap-guangzhou”</code></p>
<table margin:auto><tr>
<td><div class="tag-plugin image"><div class="image-bg"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.hermitlsr.top/images/post/bber/20220119184545.png!watermark" alt="[2.1.1 新建环境 1]" fancybox="true"/></div><div class="image-meta"><span class="image-caption center">[2.1.1 新建环境 1]</span></div></div></td>
<td><div class="tag-plugin image"><div class="image-bg"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.hermitlsr.top/images/post/bber/20220119184650.png!watermark" alt="[2.1.1 新建环境 2]" fancybox="true"/></div><div class="image-meta"><span class="image-caption center">[2.1.1 新建环境 2]</span></div></div></td>
<td><div class="tag-plugin image"><div class="image-bg"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.hermitlsr.top/images/post/bber/20220119184714.png!watermark" alt="[2.1.1 新建环境 3]" fancybox="true"/></div><div class="image-meta"><span class="image-caption center">[2.1.1 新建环境 3]</span></div></div></td>
</tr></table>
<h4 id="212-环境-登录授权"><a class="markdownIt-Anchor" href="#212-环境-登录授权"></a> 2.1.2 <a target="_blank" rel="noopener" href="https://console.cloud.tencent.com/tcb/env/login">环境-登录授权</a></h4>
<p>选择 “匿名登录”</p>
<div class="tag-plugin image"><div class="image-bg"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.hermitlsr.top/images/post/bber/20220119190000.png!watermark" fancybox="true"/></div></div>
<h4 id="213-环境-安全配置"><a class="markdownIt-Anchor" href="#213-环境-安全配置"></a> 2.1.3 <a target="_blank" rel="noopener" href="https://console.cloud.tencent.com/tcb/env/safety">环境-安全配置</a></h4>
<p>将你要使用哔哔页面的个人网站域名添加到 “WEB安全域名”<br />
最好将你平时本地调试用的 <code>localhost:</code> 也添加进去，例如 <code>hexo</code> 本地发布默认 <code>localhost:4000</code></p>
<table margin:auto><tr>
<td><div class="tag-plugin image"><div class="image-bg"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.hermitlsr.top/images/post/bber/20220119190450.png!watermark" alt="[2.1.3 环境-安全配置 1]" fancybox="true"/></div><div class="image-meta"><span class="image-caption center">[2.1.3 环境-安全配置 1]</span></div></div></td>
<td><div class="tag-plugin image"><div class="image-bg"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.hermitlsr.top/images/post/bber/20220119190540.png!watermark" alt="[2.1.3 环境-安全配置 2]" fancybox="true"/></div><div class="image-meta"><span class="image-caption center">[2.1.3 环境-安全配置 2]</span></div></div></td>
</tr></table>
<h4 id="214-新建数据集合"><a class="markdownIt-Anchor" href="#214-新建数据集合"></a> 2.1.4 <a target="_blank" rel="noopener" href="https://console.cloud.tencent.com/tcb/db/">新建数据集合</a></h4>
<p>进入数据库，新建数据集合，命名为 <code>talks</code><br />
点击创建好的数据集合 <code>talks</code> ➡ 点击 <code>权限设置</code> ➡ 权限设置为 “所有用户可读，仅管理员可写”</p>
<table margin:auto><tr>
<td><div class="tag-plugin image"><div class="image-bg"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.hermitlsr.top/images/post/bber/20220119190930.png!watermark" alt="[2.1.4 新建数据集合 1]" fancybox="true"/></div><div class="image-meta"><span class="image-caption center">[2.1.4 新建数据集合 1]</span></div></div></td>
<td><div class="tag-plugin image"><div class="image-bg"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.hermitlsr.top/images/post/bber/20220119191027.png!watermark" alt="[2.1.4 新建数据集合 2]" fancybox="true"/></div><div class="image-meta"><span class="image-caption center">[2.1.4 新建数据集合 2]</span></div></div></td>
</tr></table>
第一个坑来了：
点击文档列表 ➡ 点击添加文档 字段设置为 `content` 值设置 为任意文本。
这一步是为了避免数据库中没有记录导致微信发布时写入失败，前人遇到的贼大的一个坑，直接在创建的时候解决。
<div class="tag-plugin image"><div class="image-bg"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.hermitlsr.top/images/post/bber/20220119200323.png!watermark" fancybox="true"/></div></div>
<h3 id="22-云函数部署"><a class="markdownIt-Anchor" href="#22-云函数部署"></a> 2.2 云函数部署</h3>
<h4 id="221-新建云函数"><a class="markdownIt-Anchor" href="#221-新建云函数"></a> 2.2.1 <a target="_blank" rel="noopener" href="https://console.cloud.tencent.com/tcb/scf/index">新建云函数</a></h4>
<ol>
<li>点击侧边栏 基础服务-云函数 ➡ 点击新建云函数 ➡ 运行环境选择 <code>Nodejs 10.15</code> ➡ 函数名称设置 <code>bber</code> （可自定义）</li>
<li>点击下一步 ➡ 描述部分随意，函数代码部分 复制 <a target="_blank" rel="noopener" href="https://github.com/lmm214/bber/blob/main/bber/index.js">index.js</a> 代码到函数代码框中，点确定。</li>
<li>点击创建好的 <code>bber</code> ， 点击函数代码，右键新建文件 <code>package.json</code> 文件</li>
<li>复制 <a target="_blank" rel="noopener" href="https://github.com/lmm214/bber/blob/main/bber/package.json">package.json</a> 代码丢入 <code>package.json</code>，点击 <code>保存并安装依赖</code>。<br />
成功后，文件目录会出现 <code>node_modules</code> 文件夹</li>
</ol>
<table margin:auto><tr>
<td><div class="tag-plugin image"><div class="image-bg"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.hermitlsr.top/images/post/bber/20220119192915.png!watermark" alt="[2.2.1 新建云函数 1]" fancybox="true"/></div><div class="image-meta"><span class="image-caption center">[2.2.1 新建云函数 1]</span></div></div></td>
<td><div class="tag-plugin image"><div class="image-bg"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.hermitlsr.top/images/post/bber/20220119192854.png!watermark" alt="[2.2.1 新建云函数 2]" fancybox="true"/></div><div class="image-meta"><span class="image-caption center">[2.2.1 新建云函数 2]</span></div></div></td>
<td><div class="tag-plugin image"><div class="image-bg"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.hermitlsr.top/images/post/bber/20220119193201.png!watermark" alt="[2.2.1 新建云函数 3]" fancybox="true"/></div><div class="image-meta"><span class="image-caption center">[2.2.1 新建云函数 3]</span></div></div></td>
<td><div class="tag-plugin image"><div class="image-bg"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.hermitlsr.top/images/post/bber/20220119193340.png!watermark" alt="[2.2.1 新建云函数 4]" fancybox="true"/></div><div class="image-meta"><span class="image-caption center">[2.2.1 新建云函数 4]</span></div></div></td>
</tr></table>
<div class="tag-plugin grid" ><div class="cell" index="0"></div></div>
<h4 id="222-环境-访问服务"><a class="markdownIt-Anchor" href="#222-环境-访问服务"></a> 2.2.2 <a target="_blank" rel="noopener" href="https://console.cloud.tencent.com/tcb/env/access">环境-访问服务</a></h4>
<p>新建，路径与云函数名匹配。</p>
<div class="tag-plugin image"><div class="image-bg"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.hermitlsr.top/images/post/bber/20220119195114.png!watermark" fancybox="true"/></div></div>
<p>大概需要3-5分钟时间创建，创建好之后，点击触发路径或在浏览器中输入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://你后台显示的.ap-shanghai.app.tcloudbase.com/bber</span><br></pre></td></tr></table></figure>
<p>会出现 <code>&#123;&quot;content&quot;:&quot;key不匹配&quot;&#125;</code> 则说明配置好了</p>
<div class="tag-plugin grid" ><div class="cell" index="0"></div></div>
<p>这里说的 <code>apikey</code> 在云函数 <code>index.js</code> 的第8行，<code>const serverkey = 'bber'</code>，将其改为你自定义的 key 值，避免别人拿到你的信息绑定之后乱搞。</p>
<p>配置到这个地方，就可以绑定微信公众号发说说，可以直接使用作者的公众号【见封面，或者搜索哔哔点啥】<br />
发送如下即可绑定成功</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/bber key值,https://你的云函数HTTP访问地址/bber</span><br></pre></td></tr></table></figure>
<p>key 值为你自定义的 <code>const serverkey</code>，<br />
<code>https://你的云函数HTTP访问地址/bber</code> 为你的触发路径<br />
绑定成功后就可以发送哔哔了，数据都会储存在 前面创建的 <code>talks</code> 中。</p>
<div class="tag-plugin grid" ><div class="cell" index="0"></div></div>
<h2 id="3-哔哔点啥-前端配置"><a class="markdownIt-Anchor" href="#3-哔哔点啥-前端配置"></a> 3 哔哔点啥-前端配置</h2>
<p>虽然目前后端可以接收到数据，并存储数据，但是，还是需要在页面呈现<br />
这里可以直接使用小康大佬的美化 <a target="_blank" rel="noopener" href="https://www.antmoe.com/posts/7ec820ee/">给 bber 换个皮肤</a> 、<a target="_blank" rel="noopener" href="https://gitlab.com/DreamyTZK/ispeak-bber">ispeak-bber</a> ：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&#x27;speak&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">speak</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 使用markdown渲染 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- &lt;script type=&quot;text/javascript&quot; src=&quot;https://cdn.jsdelivr.net/npm/ispeak-bber/ispeak-bber-md.min.js&quot; charset=&quot;utf-8&quot; &gt;&lt;/script&gt; --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 不使用markdown渲染 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/ispeak-bber/ispeak-bber.min.js&quot;</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 解析微信表情（参考：https://github.com/buddys/qq-wechat-emotion-parser） --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- &lt;script src=&quot;https://cdn.jsdelivr.net/gh/buddys/qq-wechat-emotion-parser@master/dist/qq-wechat-emotion-parser.min.js&quot;&gt;&lt;/script&gt; --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">ispeakBber</span></span><br><span class="line"><span class="language-javascript">    .<span class="title function_">init</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">el</span>: <span class="string">&#x27;#speak&#x27;</span>, <span class="comment">// 容器选择器</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">name</span>: <span class="string">&#x27;DreamyTZK 🦄&#x27;</span>, <span class="comment">// 显示的昵称</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">envId</span>: <span class="string">&#x27;腾讯云开发环境id&#x27;</span>, <span class="comment">// 环境id</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">region</span>: <span class="string">&#x27;ap-shanghai&#x27;</span>, <span class="comment">// 腾讯云地址，默认为上海</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">limit</span>: <span class="number">10</span>, <span class="comment">// 每次加载的条数，默认为5</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">avatar</span>: <span class="string">&#x27;https://cdn.jsdelivr.net/npm/kang-static@latest/avatar.jpg&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">fromColor</span>:<span class="string">&#x27;rgb(245, 150, 170)&#x27;</span>, <span class="comment">// 下方标签背景颜色 默认 rgb(245, 150, 170)</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">loadingImg</span>: <span class="string">&#x27;https://7.dusays.com/2021/03/04/d2d5e983e2961.gif&#x27;</span>, <span class="comment">// 自定义loading的图片，示例值为默认值</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">dbName</span>:<span class="string">&#x27;talks&#x27;</span> <span class="comment">// 数据的名称，默认talks，避免有人的命名不是这个，所以加入此配置字段。</span></span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript">    .<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 哔哔加载完成后的回调函数，你可以写你自己的功能</span></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;哔哔 加载完成&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>如果需要支持歌曲分享，请看：<a target="_blank" rel="noopener" href="https://guole.fun/posts/34234/">ispeak-bber 前端美化增强版，支持歌曲分享</a></p>
<p>目前我的说说页面，说说总量的计算是没有显示的，这个问题有待研究。</p>
<p>具体到每个主题的配置要看每个主题的页面情况，大体都是新建 <code>index.md</code> 文件，将其直接复制进去就可以了。<br />
stellar 适配：<a target="_blank" rel="noopener" href="http://www.hermitlsr.top/2022-01-19/%E5%93%94%E5%93%94%E7%82%B9%E5%95%A5-%E9%85%8D%E7%BD%AE%E8%AE%B0%E5%BD%95/#4-%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2%E7%9A%84-stellar-%E4%B8%BB%E9%A2%98%E9%80%82%E9%85%8D">可见本文下方:前端页面的-stellar-主题适配</a><br />
Butterfly 适配：<a target="_blank" rel="noopener" href="https://blog.zhheo.com/p/a6947667.html">Hexo-Butterfly说说朋友圈适配（哔哔 for 腾讯云）自用</a></p>
<h2 id="4-哔哔点啥-微信公众号配置"><a class="markdownIt-Anchor" href="#4-哔哔点啥-微信公众号配置"></a> 4 哔哔点啥-微信公众号配置</h2>
<p>这个配置因人而异，嫌麻烦可以直接用原作者的微信公众号，但是我希望将所有数据放在自己手里，所以用自己的公众号<br />
这里的公众号个人的就可以，新注册的就行，没什么别的要求。</p>
<h3 id="41-新建云函数"><a class="markdownIt-Anchor" href="#41-新建云函数"></a> 4.1 <a target="_blank" rel="noopener" href="https://console.cloud.tencent.com/tcb/scf/index">新建云函数</a></h3>
<p>参考前面 哔哔点啥后端的配置过程。</p>
<p>创建云函数的时候一定记得修改运行环境为：<code>Nodejs 10.15</code><br />
如果使用默认的 <code>Nodejs 12.16</code> 需要将 <code>package.json</code> 中的 <code>&quot;type&quot;: &quot;module&quot;,</code> 删掉<br />
原因在于作者发布的教程的这段时间里，<code>ES Module</code> 的版本迭代，一开始不再支持 <code>require</code> 而采用 <code>import</code>，除非在 <code>package.json</code> 中加入 <code>&quot;type&quot;: &quot;module&quot;,</code>。而最新版的 <code>js</code> 好像又解决了这个问题，不需要加入 <code>&quot;type&quot;: &quot;module&quot;,</code>，加入了反而会报错。</p>
<p>云函数命名为 <code>bber-weixin</code><br />
<code>index.js</code> 和 <code>package.json</code> 来自于 <a target="_blank" rel="noopener" href="https://github.com/lmm214/bber-weixin/tree/main/bber-weixin">https://github.com/lmm214/bber-weixin/tree/main/bber-weixin</a></p>
<h3 id="42-获取公网-ip"><a class="markdownIt-Anchor" href="#42-获取公网-ip"></a> 4.2 获取公网 Ip</h3>
<p>点击 <a target="_blank" rel="noopener" href="https://console.cloud.tencent.com/tcb/scf/index">bber-weixin</a> 云函数，右上角 <strong>【编辑】</strong>，开启 <strong>【固定IP】</strong>，留存 <strong>公网固定IP</strong>。</p>
<table margin:auto><tr>
<td><div class="tag-plugin image"><div class="image-bg"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.hermitlsr.top/images/post/bber/20220119205230.png!watermark" alt="[4.2 获取公网 Ip 1]" fancybox="true"/></div><div class="image-meta"><span class="image-caption center">[4.2 获取公网 Ip 1]</span></div></div></td>
<td><div class="tag-plugin image"><div class="image-bg"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.hermitlsr.top/images/post/bber/20220119205354.png!watermark" alt="[4.2 获取公网 Ip 2]" fancybox="true"/></div><div class="image-meta"><span class="image-caption center">[4.2 获取公网 Ip 2]</span></div></div></td>
</tr></table>
<p>保存成功后，固定 IP 那里会出现一个 IP 地址，留存这个地址备用。</p>
<h3 id="43-新建数据集合"><a class="markdownIt-Anchor" href="#43-新建数据集合"></a> 4.3 <a target="_blank" rel="noopener" href="https://console.cloud.tencent.com/tcb/db/">新建数据集合</a></h3>
<p>进入数据库，新建数据集合，命名为 <code>users</code><br />
点击创建好的数据集合 <code>users</code> ➡ 点击 <code>权限设置</code> ➡ 权限设置为 <code>仅创建者及管理员可读写</code><br />
该数据集合用于存储公众号的绑定的哔哔用户。</p>
<h3 id="44-获取触发路径链接"><a class="markdownIt-Anchor" href="#44-获取触发路径链接"></a> 4.4 <a target="_blank" rel="noopener" href="https://console.cloud.tencent.com/tcb/env/access">获取触发路径链接</a></h3>
<p>进入 <a target="_blank" rel="noopener" href="https://console.cloud.tencent.com/tcb/env/access">环境-访问服务</a> ，新建 <code>/bber-weixin</code> 触发路径<br />
获取这个触发路径链接并留存，如以下格式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https://××××××.ap-shanghai.app.tcloudbase.com/bber-weixin</span><br><span class="line">或者</span><br><span class="line">https://自定义域名/bber-weixin</span><br></pre></td></tr></table></figure>
<h3 id="45-微信公众平台配置"><a class="markdownIt-Anchor" href="#45-微信公众平台配置"></a> 4.5 <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/">微信公众平台配置</a></h3>
<p>打开 <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/">微信公众平台</a>，进入开发-基本配置，获取 <code>AppID</code> 和 <code>AppSecret</code> 留存，修改IP白名单为上一步的 <code>公网固定IP</code> 。<br />
继续服务器配置:</p>
<div class="tag-plugin image"><div class="image-bg"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.hermitlsr.top/images/post/bber/20220119210322.png!watermark" fancybox="true"/></div></div>
<p><code>URL</code> 为 <a target="_blank" rel="noopener" href="https://hermitlsr.top/2022-01-19/%E5%93%94%E5%93%94%E7%82%B9%E5%95%A5-%E9%85%8D%E7%BD%AE%E8%AE%B0%E5%BD%95/#44-%E8%8E%B7%E5%8F%96%E8%A7%A6%E5%8F%91%E8%B7%AF%E5%BE%84%E9%93%BE%E6%8E%A5">4.4</a> 留存的触发链接；<br />
<code>Token</code> 可以自定义，原始代码中预设为 <code>weixin</code><br />
此时先不点提交，还要回到 云函数 配置。</p>
<h3 id="46-回-bber-weixin-云函数"><a class="markdownIt-Anchor" href="#46-回-bber-weixin-云函数"></a> 4.6 回 <a target="_blank" rel="noopener" href="https://console.cloud.tencent.com/tcb/scf/index">bber-weixin</a> 云函数</h3>
<p>回 <a target="_blank" rel="noopener" href="https://console.cloud.tencent.com/tcb/scf/index">bber-weixin</a> 云函数，填入微信公众号 <code>AppID</code> 和 <code>AppSecret</code> 保存。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> token = <span class="string">&#x27;weixin&#x27;</span> <span class="comment">// 微信公众号的服务器验证用的令牌 token，我自定义为了 ceshi123，这里就填 ceshi23</span></span><br><span class="line"><span class="comment">//填入自己的微信公众号appid和appsecret</span></span><br><span class="line"><span class="keyword">var</span> wxappid = <span class="string">&#x27;微信公众号appid&#x27;</span>,</span><br><span class="line">    wxappsecret = <span class="string">&#x27;微信公众号appsecret&#x27;</span>,</span><br></pre></td></tr></table></figure>
<h3 id="46-回-微信公众平台"><a class="markdownIt-Anchor" href="#46-回-微信公众平台"></a> 4.6 回 <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/">微信公众平台</a></h3>
<p>点击提交，显示提交成功，之后启用服务器配置，很快就会生效。</p>
<h3 id="47-回-bber-weixin-云函数"><a class="markdownIt-Anchor" href="#47-回-bber-weixin-云函数"></a> 4.7 回 <a target="_blank" rel="noopener" href="https://console.cloud.tencent.com/tcb/scf/index">bber-weixin</a> 云函数</h3>
<p>注释第44行代码，保存:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if(tmpStr == signature)&#123;</span><br><span class="line">    //请求来源鉴权</span><br><span class="line">    //成功后注释下行代码</span><br><span class="line">    //return event.queryStringParameters.echostr //成功后注释本行代码</span><br><span class="line">    //成功后注释上行代码</span><br></pre></td></tr></table></figure>
<p>到此，公众号配置完成，可以绑定自己的公众愉快的发布哔哔了。</p>
<p>我是自己手动部署，在这里踩得坑主要是运行环境不匹配和未建立 <code>users</code> 数据集，如果直接使用作者的一键部署可以避免这个问题，但是按量计费属实划不来</p>
<h2 id="5-前端页面的-stellar-主题适配"><a class="markdownIt-Anchor" href="#5-前端页面的-stellar-主题适配"></a> 5 前端页面的 stellar 主题适配</h2>
<p>stellar 主题没有给出太多自定义的空间，可以看到我的说说页面在顶部的 <code>归档旁边</code></p>
<div class="tag-plugin image"><div class="image-bg"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.hermitlsr.top/images/post/bber/20220119202332.png!watermark" fancybox="true"/></div></div>
<p>实际上的配置并不复杂</p>
<h3 id="51-在根目录-source-新建-bbtalk-文件夹"><a class="markdownIt-Anchor" href="#51-在根目录-source-新建-bbtalk-文件夹"></a> 5.1 在根目录 <code>source</code> 新建 <code>bbtalk</code> 文件夹</h3>
<p>文件夹建好后，新建一个 <code>index.md</code> 文件，这个文件用于存放前端代码 ，也就是哔哔页面</p>
<details class="tag-plugin folding" color="gray"><summary><span>查看代码</span></summary><div class="body"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">menu_id: more</span><br><span class="line">sidebar: [welcome, recent]</span><br><span class="line">seo_title: 闲话</span><br><span class="line">comments: false</span><br><span class="line">breadcrumb: false</span><br><span class="line">header: false</span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">&lt;div id=&#x27;speak&#x27;&gt;&lt;/speak&gt;</span><br><span class="line">&lt;!-- 使用markdown渲染 --&gt;</span><br><span class="line">&lt;!-- &lt;script type=&quot;text/javascript&quot; src=&quot;https://cdn.jsdelivr.net/npm/ispeak-bber/ispeak-bber-md.min.js&quot; charset=&quot;utf-8&quot; &gt;&lt;/script&gt; --&gt;</span><br><span class="line">&lt;!-- 不使用markdown渲染 --&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;https://cdn.jsdelivr.net/npm/ispeak-bber/ispeak-bber.min.js&quot; charset=&quot;utf-8&quot; &gt;&lt;/script&gt;</span><br><span class="line">&lt;!-- 解析微信表情（参考：https://github.com/buddys/qq-wechat-emotion-parser） --&gt;</span><br><span class="line">&lt;!-- &lt;script src=&quot;https://cdn.jsdelivr.net/gh/buddys/qq-wechat-emotion-parser@master/dist/qq-wechat-emotion-parser.min.js&quot;&gt;&lt;/script&gt; --&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">ispeakBber</span><br><span class="line">    .init(&#123;</span><br><span class="line">      el: &#x27;#speak&#x27;, // 容器选择器</span><br><span class="line">      name: &#x27;DreamyTZK 🦄&#x27;, // 显示的昵称</span><br><span class="line">      envId: &#x27;腾讯云开发环境id&#x27;, // 环境id</span><br><span class="line">      region: &#x27;ap-shanghai&#x27;, // 腾讯云地址，默认为上海</span><br><span class="line">      limit: 10, // 每次加载的条数，默认为5</span><br><span class="line">      avatar: &#x27;https://cdn.jsdelivr.net/npm/kang-static@latest/avatar.jpg&#x27;,</span><br><span class="line">      fromColor:&#x27;rgb(245, 150, 170)&#x27;, // 下方标签背景颜色 默认 rgb(245, 150, 170)</span><br><span class="line">      loadingImg: &#x27;https://7.dusays.com/2021/03/04/d2d5e983e2961.gif&#x27;, // 自定义loading的图片，示例值为默认值</span><br><span class="line">      dbName:&#x27;talks&#x27; // 数据的名称，默认talks，避免有人的命名不是这个，所以加入此配置字段。</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(function() &#123;</span><br><span class="line">      // 哔哔加载完成后的回调函数，你可以写你自己的功能</span><br><span class="line">      console.log(&#x27;哔哔 加载完成&#x27;)</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div></details>
<h3 id="52-配置到首页"><a class="markdownIt-Anchor" href="#52-配置到首页"></a> 5.2 配置到首页</h3>
<p>事实上，此时在发布网站后，已经可以直接通过 <a target="_blank" rel="noopener" href="https://hermitlsr.top/bbtalk/">https://hermitlsr.top/bbtalk/</a> 访问到页面<br />
一开始我是把这个页面放在 <code>about</code> 页的导航栏里的 直接写相对路径就行。<br />
后来我突发奇想，把这个放到首页去，大概需要这几步：</p>
<ol>
<li>修改主题文件 <code>languages</code></li>
<li>修改主题文件 <code>\themes\stellar\layout\_partial\main\navbar\list_post.ejs</code></li>
<li>修改网站设置 <code>_config.yml</code></li>
</ol>
<h4 id="521-修改主题文件-languages"><a class="markdownIt-Anchor" href="#521-修改主题文件-languages"></a> 5.2.1 修改主题文件 <code>languages</code></h4>
<p>这一步是进行语言配置，在 <code>btn</code> 部分添加 <code>bbtalk</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># zh-CN.yml</span><br><span class="line">btn:</span><br><span class="line">  bbtalk: 闲话</span><br><span class="line"></span><br><span class="line"># zh-TW.yml</span><br><span class="line">btn:</span><br><span class="line">  bbtalk: 閒話  </span><br></pre></td></tr></table></figure>
<p>没设置英语，实在不知道咋翻译合适。</p>
<h4 id="522-修改主题文件-themesstellarlayout_partialmainnavbarlist_postejs"><a class="markdownIt-Anchor" href="#522-修改主题文件-themesstellarlayout_partialmainnavbarlist_postejs"></a> 5.2.2 修改主题文件 <code>\themes\stellar\layout\_partial\main\navbar\list_post.ejs</code></h4>
<p>找到 <code>\themes\stellar\layout\_partial\main\navbar\list_post.ejs</code> 在其第 32 行后 添加如下代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;% if (config.bbtalk) &#123; %&gt;</span><br><span class="line">&lt;a  href=&#x27;/bbtalk/&#x27;&gt;&lt;%- __(&#x27;btn.bbtalk&#x27;) %&gt;&lt;/a&gt;</span><br><span class="line">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure>
<p>意思是，如果站点根设置中 <code>bbtalk</code> 的值为 <code>true</code> 则显示相对链接为 <code>/bbtalk/</code> 的页面。<br />
当然，你要乐意，改成 <code>theme.bbtalk</code> 放到主题设置里也行，不过没必要。</p>
<h4 id="523-修改网站设置-_configyml"><a class="markdownIt-Anchor" href="#523-修改网站设置-_configyml"></a> 5.2.3 修改网站设置 <code>_config.yml</code></h4>
<p>在设置的最下面添加：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">bbtalk:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>重新发布网站就可以看到了。</p>
<h2 id="6-踩坑点汇总"><a class="markdownIt-Anchor" href="#6-踩坑点汇总"></a> 6 踩坑点汇总</h2>
<ol>
<li>运行环境问题，最好使用作者原始运行环境：<code>Nodejs 10.15</code>；</li>
<li>记得新建数据集 <code>users</code>；</li>
<li>记得在 <code>talks</code> 数据集中提前创建数据。</li>
</ol>


<div class="article-footer reveal fs14"><section id="references"><div class="header"><span>参考资料</span></div><div class="body"><ul><li class="post-title"><a href="https://immmmm.com/bb-by-wechat-pro/" target="_blank" rel="external nofollow noopener noreferrer">「哔哔点啥」微信公众号 2.0</a></li><li class="post-title"><a href="https://www.antmoe.com/posts/7ec820ee/" target="_blank" rel="external nofollow noopener noreferrer">给 bber 换个皮肤</a></li><li class="post-title"><a href="https://gitlab.com/DreamyTZK/ispeak-bber" target="_blank" rel="external nofollow noopener noreferrer">ispeak-bber 源代码</a></li><li class="post-title"><a href="https://guole.fun/posts/bber-caikeng/" target="_blank" rel="external nofollow noopener noreferrer">Android “捷径”・木木 bber 踩坑记录 + 电脑 or 手机 4 种方式直发说说</a></li></ul></div></section><section id="license"><div class="header"><span>许可协议</span></div><div class="body"><p>未经允许，禁止转载</p>
</div></section></div>

</article>

<div class="related-wrap reveal" id="read-next"><section class="body"><div class="item" id="prev"><div class="note">较新文章</div><a href="/2022-06-05/Hexo%E5%85%AC%E5%BC%8F%E9%97%AE%E9%A2%98-%E5%A4%9A%E8%A1%8C%E5%85%AC%E5%BC%8F%E6%98%BE%E7%A4%BA/">Hexo公式问题 - 多行公式显示</a></div><div class="item" id="next"><div class="note">较早文章</div><a href="/2022-01-12/%E9%87%8D%E5%90%AF%E5%8D%9A%E5%AE%A2/">重启博客，重启时光</a></div></section></div>








      
<footer class="page-footer reveal fs12"><hr><div class="sitemap"><div class="sitemap-group"><span class="fs14">博客</span><a href="/">近期</a><a href="/blog/categories/">分类</a><a href="/blog/tags/">标签</a><a href="/blog/archives/">归档</a></div><div class="sitemap-group"><span class="fs14">智库</span><a href="/wiki/tags/%E7%AC%94%E8%AE%B0/">笔记</a></div><div class="sitemap-group"><span class="fs14">社交</span><a href="/friends/">友链</a></div><div class="sitemap-group"><span class="fs14">更多</span><a href="/about/">关于本站</a><a target="_blank" rel="noopener" href="https://github.com/inkinklee">GitHub</a></div></div><div class="text"><p>本站由 <a href="/">@anonymity</a> 使用 <a target="_blank" rel="noopener" href="https://github.com/xaoxuu/hexo-theme-stellar">Stellar</a> 主题创建。<br />
本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议，转载请注明出处。</p>
</div></footer>

      <div class='float-panel mobile-only blur' style='display:none'>
  <button type='button' class='sidebar-toggle mobile' onclick='sidebar.toggle()'>
    <svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="15301"><path d="M566.407 808.3c26.9-0.1 49.3-20.8 51.6-47.6-1.9-27.7-23.9-49.7-51.6-51.6h-412.6c-28.2-1.4-52.6 19.5-55.5 47.6 2.3 26.8 24.6 47.5 51.6 47.6h416.5v4z m309.3-249.9c26.9-0.1 49.3-20.8 51.6-47.6-2.2-26.8-24.6-47.5-51.6-47.6h-721.9c-27.7-2.8-52.5 17.4-55.3 45.1-0.1 0.8-0.1 1.7-0.2 2.5 0.9 27.2 23.6 48.5 50.7 47.6H875.707z m-103.1-245.9c26.9-0.1 49.3-20.8 51.6-47.6-0.4-28.3-23.2-51.1-51.5-51.6h-618.9c-29.5-1.1-54.3 21.9-55.5 51.4v0.2c1.4 27.8 25.2 49.2 53 47.8 0.8 0 1.7-0.1 2.5-0.2h618.8z" p-id="15302"></path><path d="M566.407 808.3c26.9-0.1 49.3-20.8 51.6-47.6-1.9-27.7-23.9-49.7-51.6-51.6h-412.6c-28.2-1.4-52.6 19.5-55.5 47.6 1.9 27.7 23.9 49.7 51.6 51.6h416.5z m309.3-249.9c26.9-0.1 49.3-20.8 51.6-47.6-2.2-26.8-24.6-47.5-51.6-47.6h-721.9c-27.7-2.8-52.5 17.4-55.3 45.1-0.1 0.8-0.1 1.7-0.2 2.5 0.9 27.2 23.6 48.5 50.7 47.6H875.707z m-103.1-245.9c26.9-0.1 49.3-20.8 51.6-47.6-0.4-28.3-23.2-51.1-51.5-51.6h-618.9c-29.5-1.1-54.3 21.9-55.5 51.4v0.2c1.4 27.8 25.2 49.2 53 47.8 0.8 0 1.7-0.1 2.5-0.2h618.8z" p-id="15303"></path></svg>
  </button>
</div>

    </div>
  </div>
  <div class='scripts'>
    <script type="text/javascript">
  const stellar = {
    // 懒加载 css https://github.com/filamentgroup/loadCSS
    loadCSS: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    // 从 butterfly 和 volantis 获得灵感
    loadScript: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      if (src.startsWith('/')){
        src = stellar.config.root + src.substring(1);
      }
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // 默认异步，如果需要同步，第二个参数传入 {} 即可
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    // https://github.com/jerryc127/hexo-theme-butterfly
    jQuery: (fn) => {
      if (typeof jQuery === 'undefined') {
        stellar.loadScript(stellar.plugins.jQuery).then(fn)
      } else {
        fn()
      }
    }
  };
  stellar.version = '1.18.5';
  stellar.github = 'https://github.com/xaoxuu/hexo-theme-stellar/tree/1.18.5';
  stellar.config = {
    date_suffix: {
      just: '刚刚',
      min: '分钟前',
      hour: '小时前',
      day: '天前',
      month: '个月前',
    },
    root : '/',
  };

  // required plugins (only load if needs)
  stellar.plugins = {
    jQuery: 'https://gcore.jsdelivr.net/npm/jquery@3.6.2/dist/jquery.min.js'
  };

  if ('local_search') {
    stellar.search = {};
    stellar.search.service = 'local_search';
    if (stellar.search.service == 'local_search') {
      let service_obj = Object.assign({}, {"field":"all","path":"/search.json","content":true,"sort":"-date"});
      stellar.search[stellar.search.service] = service_obj;
    }
  }

  // stellar js
  stellar.plugins.stellar = Object.assign({"sites":"/js/plugins/sites.js","friends":"/js/plugins/friends.js","ghinfo":"/js/plugins/ghinfo.js","timeline":"/js/plugins/timeline.js","linkcard":"/js/plugins/linkcard.js","fcircle":"/js/plugins/fcircle.js","weibo":"/js/plugins/weibo.js"});

  stellar.plugins.marked = Object.assign("https://cdn.bootcdn.net/ajax/libs/marked/4.0.18/marked.min.js");
  // optional plugins
  if ('true' == 'true') {
    stellar.plugins.lazyload = Object.assign({"enable":true,"js":"https://gcore.jsdelivr.net/npm/vanilla-lazyload@17.8.3/dist/lazyload.min.js","transition":"blur"});
  }
  if ('true' == 'true') {
    stellar.plugins.swiper = Object.assign({"enable":true,"css":"https://unpkg.com/swiper@8.4.5/swiper-bundle.min.css","js":"https://unpkg.com/swiper@8.4.5/swiper-bundle.min.js"});
  }
  if ('' == 'true') {
    stellar.plugins.scrollreveal = Object.assign({"enable":null,"js":"https://gcore.jsdelivr.net/npm/scrollreveal@4.0.9/dist/scrollreveal.min.js","distance":"8px","duration":500,"interval":100,"scale":1});
  }
  if ('true' == 'true') {
    stellar.plugins.preload = Object.assign({"enable":true,"service":"flying_pages","instant_page":"https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@4.1.2/js/instant_page.js","flying_pages":"https://gcore.jsdelivr.net/gh/gijo-varghese/flying-pages@2.1.2/flying-pages.min.js"});
  }
  if ('true' == 'true') {
    stellar.plugins.fancybox = Object.assign({"enable":true,"js":"https://gcore.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.umd.js","css":"https://gcore.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.css","selector":".swiper-slide img"});
  }
  if ('false' == 'true') {
    stellar.plugins.heti = Object.assign({"enable":false,"css":"https://unpkg.com/heti@0.9.2/umd/heti.min.css","js":"https://unpkg.com/heti@0.9.2/umd/heti-addon.min.js"});
  }
</script>

<!-- required -->

  
<script src="/js/main.js" async></script>



<!-- optional -->



<!-- inject -->

  
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" type="text/javascript"></script>
  


  </div>
</body>
</html>
